# JSON-Schema Codegen

This python library consumes JSON-Schema and generates C++ code.  It generates structures to hold the values defined in the schema, restricting the values according to the schema. 

Where possible, the schema is enforced through by C++ types, so that errors in data construction are enforced at compile time.  For example, an object with two required parameters will be a C++ object where the constructor requires the two parameters.

When compile time enforcement is not possible, we resort to throwing an exception when the data objects are constructed.  For example, constructing an int-based object with a number greater than the maximum would throw an exception.

## Python Requirements for Code Generation

These requirements should be satisfied when `pip3` installing `json-schema-codegen`.

* python 3.7 or later
* jinja2
* stringcase

### Requirements for testing

Because test suites will actually generate code, compile them, and use them, we require a C++ compiler to be installed as well as the runtime dependencies.

## Installation

```sh
pip3 install json-schema-codegen
```

## C++ Generated Code

### Supported Schema Features in C++ code generation

A C++ class is generated for each schema node according to the schema's `type` property.  Schemas without a `type` property, with the exception of combining operators `*Of`, are not supported.

* type: string
    * minLength
    * maxLength
    * pattern
    * format=date-time (enforces ISO8601 format)
    * format=uuid (enables string object to be populated with a uuid)
* type: string with enum
* type: integer
    * maximum
    * minimum
    * exclusiveMaximum
    * exclusiveMinimum
    * multipleOf
* type: number
    * maximum
    * minimum
    * exclusiveMaximum
    * exclusiveMinimum
    * multipleOf 
* type: boolean
* type: null
* type: array
    * items
    * minItems
    * maxItems
    * uniqueItems
* type: object
    * properties
    * required
* allOf
* anyOf
    * Including a `true` schema in the `anyOf` list can be used to create a structure which implies "zero or more".
* oneOf

On any type, the `default`, `examples`, `title`, and `description` properties can be used.

##### References

`$ref` references are supported for array items, object properties, allOf, anyOf, and oneOf, through providing a proper "resolver" object to the jacobs-json-doc parser.

### Dependencies of the C++ generated code

* boost (boost::optional and boost::variant among others)
* rapidjson 1.1
* C++11

### Usage
See [example_usage.py](./examples/example_usage.py) for a more elaborate example on generating C++ code.

```py
from jsonschemacodegen import cpp, cpp_namer
import jacobsjsondoc

output_dir = "/tmp"
namer = cpp_name.CppNamer(output_dir)
generator = cpp.GeneratorFromSchema(namer)

sample_schema_text = """{"type": "string"}"""
schema = jacobsjsondoc.parse(sample_schema_text)
generator.generate(schema, 'example.schema', '/example')
```

## Python code generation dropped

Python code generation has been removed.

It didn't really make sense. It is easy enough to create the data structures directly in python.  There weren't enough benefits over using an existing JSON Schema validator to warrent continued development.

## License

Copyright 2019-2021 Jacob Brunson

Licensing is tricky here, because I want to encourage any modifications to the source code to be re-published.  Because this generates souce code, putting many eyes on this project's source code, especially template code, improves the quality and security of the generated code.

However, I don't want to restrict any of the code generated by this project, to enable you to use it however you wish, including in proprietary programs.

I think the licensing should work similar to the license for the GCC compiler: the compiler itself is GPL, but the binary machine code it creates has no implied copyright.

So I'm applying the [GPLv2 license](./LICENSE) to this project, with the specific exception that any output generated by this code retains the same copyright/license of the YAML/JSON/Schemas provided to the generator.  I make no claims or warranties to the code, examples, documents, or other artifacts generated by this project.


